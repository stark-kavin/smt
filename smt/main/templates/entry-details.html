<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    {% load static %}
    <link rel="stylesheet" href="{% static '/css/entry-details.css' %}">
</head>

<body>
    <nav>
        <a href="{% url 'entry' %}">
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed">
                <path d="m313-440 224 224-57 56-320-320 320-320 57 56-224 224h487v80H313Z" />
            </svg>
            Back to Entries
        </a>
        <h2>Entry Details</h2>
    </nav>
    <div class="main-container">
        <div class="main-wrapper">
            <div class="head">
                <h3>Entry #{{entry.id}}</h3>
                <div class="options">
                    <abbr title="Edit"><button>
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                                fill="#FFFFFF">
                                <path
                                    d="M200-200h57l391-391-57-57-391 391v57Zm-80 80v-170l528-527q12-11 26.5-17t30.5-6q16 0 31 6t26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120H120Zm640-584-56-56 56 56Zm-141 85-28-29 57 57-29-28Z" />
                            </svg>
                        </button></abbr>
                    <abbr title="Delete"><button id="delete-btn" class="delete">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                                fill="#FFFFFF">
                                <path
                                    d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z" />
                            </svg>
                        </button></abbr>
                </div>
            </div>
            <table id="table-details">
                <tbody>
                    <tr>
                        <td>Entry Party</td>
                        <td>
                            <div class="detail-grp">
                                <div class="h">{{entry.party.name}}</div>
                                <div class="details">
                                    {% if entry.party.location %}
                                    <div class="d">
                                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960"
                                            width="24px" fill="#FFFFFF">
                                            <path
                                                d="M480-480q33 0 56.5-23.5T560-560q0-33-23.5-56.5T480-640q-33 0-56.5 23.5T400-560q0 33 23.5 56.5T480-480Zm0 400Q319-217 239.5-334.5T160-552q0-150 96.5-239T480-880q127 0 223.5 89T800-552q0 100-79.5 217.5T480-80Z" />
                                        </svg>
                                        {{entry.party.location}}
                                    </div>
                                    {% endif %}
                                    {% if entry.party.phone %}
                                    <div class="d">
                                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960"
                                            width="24px" fill="#FFFFFF">
                                            <path
                                                d="M798-120q-125 0-247-54.5T329-329Q229-429 174.5-551T120-798q0-18 12-30t30-12h162q14 0 25 9.5t13 22.5l26 140q2 16-1 27t-11 19l-97 98q20 37 47.5 71.5T387-386q31 31 65 57.5t72 48.5l94-94q9-9 23.5-13.5T670-390l138 28q14 4 23 14.5t9 23.5v162q0 18-12 30t-30 12Z" />
                                        </svg>
                                        {{entry.party.phone}}
                                    </div>
                                    {% endif %}
                                    {% if entry.party.gst %}
                                    <div class="d">
                                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960"
                                            width="24px" fill="#FFFFFF">
                                            <path
                                                d="M531-260h96v-3L462-438l1-3h10q54 0 89.5-33t43.5-77h40v-47h-41q-3-15-10.5-28.5T576-653h70v-47H314v57h156q26 0 42.5 13t22.5 32H314v47h222q-6 20-23 34.5T467-502H367v64l164 178ZM480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T120-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Z" />
                                        </svg>
                                        {{entry.party.gst}}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>Entry Date</td>
                        <td>
                            <div class="detail-grp">
                                <div class="h">{{entry.date}}</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>From</td>
                        <td>
                            <div class="detail-grp">
                                <div class="h">{{entry.customer_from}}</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>TO</td>
                        <td>
                            <div class="detail-grp">
                                <div class="h">{{entry.customer_to}}</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>Vehicle</td>
                        <td>
                            <div class="detail-grp">
                                <div class="h">{{entry.vehicle.name}}</div>
                                <div class="details">
                                    {% if entry.vehicle.number %}
                                    <div class="d">
                                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960"
                                            width="24px" fill="#FFFFFF">
                                            <path
                                                d="M240-160q-50 0-85-35t-35-85H40v-440q0-33 23.5-56.5T120-800h560v160h120l120 160v200h-80q0 50-35 85t-85 35q-50 0-85-35t-35-85H360q0 50-35 85t-85 35Zm0-80q17 0 28.5-11.5T280-280q0-17-11.5-28.5T240-320q-17 0-28.5 11.5T200-280q0 17 11.5 28.5T240-240Zm480 0q17 0 28.5-11.5T760-280q0-17-11.5-28.5T720-320q-17 0-28.5 11.5T680-280q0 17 11.5 28.5T720-240Zm-40-200h170l-90-120h-80v120Z" />
                                        </svg>
                                        {{entry.vehicle.number}}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>Driver</td>
                        <td>
                            <div class="detail-grp">
                                <div class="h">{{entry.driver.name}}</div>
                                <div class="details">
                                    {% if entry.driver.phone %}
                                    <div class="d">
                                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960"
                                            width="24px" fill="#FFFFFF">
                                            <path
                                                d="M480-480q33 0 56.5-23.5T560-560q0-33-23.5-56.5T480-640q-33 0-56.5 23.5T400-560q0 33 23.5 56.5T480-480Zm0 400Q319-217 239.5-334.5T160-552q0-150 96.5-239T480-880q127 0 223.5 89T800-552q0 100-79.5 217.5T480-80Z" />
                                        </svg>
                                        {{entry.driver.phone}}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </td>
                    </tr>

                    <tr>
                        <td>No Of Invoices</td>
                        <td>
                            <div class="detail-grp">
                                <div class="h">{{entry.no_of_invoices}}</div>
                            </div>
                        </td>
                    </tr>

                    <tr>
                        <td>Items</td>
                        <td>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Item</th>
                                        <th>Quantity</th>
                                        <th>Amount</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for entry_item in entry.entryitem_set.all %}
                                    <tr>
                                        <td>{{ entry_item.item.name }}</td>
                                        <td>{{ entry_item.quantity }}</td>
                                        <td>â‚¹ {{ entry_item.total }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </td>
                    </tr>

                    <tr>
                        <td>Total</td>
                        <td>
                            <div class="detail-grp">
                                <div class="h">â‚¹ {{entry.total}}</div>
                            </div>
                        </td>
                    </tr>

                </tbody>
            </table>
        </div>
    </div>


    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <p>Are you sure you want to delete this entry?</p>
            <div class="modal-buttons">
                <button id="confirmDelete">Yes, Delete</button>
                <button id="cancelDelete">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Loading Modal -->
    <div id="loadingModal" class="modal">
        <div class="modal-content">
            <img src="https://discuss.wxpython.org/uploads/default/original/2X/6/6d0ec30d8b8f77ab999f765edd8866e8a97d59a3.gif"
                alt="Loading..." width="50px">
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="modal">
        <div class="modal-content">
            <p id="successMessage">Entry deleted successfully!</p>
            <div class="progress-bar">
                <div class="progress"></div>
            </div>
        </div>
    </div>

    <script>
        // Check for saved theme preference
        document.addEventListener('DOMContentLoaded', function () {
            if (localStorage.getItem('theme') !== 'light') {
                document.body.classList.add('light-theme');
            }
        });

        // Get the modal
        var deleteModal = document.getElementById("deleteModal");
        var loadingModal = document.getElementById("loadingModal");
        var successModal = document.getElementById("successModal");

        // Get the button that opens the modal
        var deleteBtn = document.getElementById("delete-btn");

        // Get the <span> element that closes the modal
        var closeBtn = document.querySelector("#deleteModal .close");

        // Get the buttons for confirmation
        var confirmDeleteBtn = document.getElementById("confirmDelete");
        var cancelDeleteBtn = document.getElementById("cancelDelete");

        // When the user clicks the button, open the modal
        deleteBtn.onclick = function () {
            deleteModal.style.display = "block";
        }

        // When the user clicks on <span> (x), close the modal
        closeBtn.onclick = function () {
            deleteModal.style.display = "none";
            successModal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
            if (event.target == deleteModal) {
                deleteModal.style.display = "none";
            }
        }

        // Handle confirm delete button click
        confirmDeleteBtn.onclick = function () {
            // Show loading modal
            deleteModal.style.display = "none";
            loadingModal.style.display = "block";

            const ID = "{{entry.id}}";
            fetch(`{% url 'ajax_delete_entry' %}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({ id: ID })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        loadingModal.style.display = "none";
                        successModal.style.display = "block";
                        document.querySelector(".progress-bar").style.display = "block";
                        setTimeout(function () {
                            window.location.href = "{% url 'entry' %}";
                        }, 2000);
                    } else {
                        alert('Failed to delete entry.');
                        deleteModal.style.display = "none";
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred.');
                    deleteModal.style.display = "none";
                });

        }

        // Handle cancel delete button click
        cancelDeleteBtn.onclick = function () {
            deleteModal.style.display = "none";
        }


    </script>
</body>

</html>